import{m as M,a as re,b as B,n as ge,i as z,k as f,d as c,g as b,s as T,h as x,p as V,S as N,F as ve,q as $e,r as fe,v as ie,w as G,x as ae,y as oe,z as se,A as ue,t as w,f as Y,B as ye,I as _e,C as F,D as L,E as me,G as Ce,H as be,J as O,K as we}from"./index-BkxCRQFY.js";import{d as Pe,u as W,e as ke,a as Te}from"./TourEditor-CNvMTJc6.js";const xe="_Asset_evmri_1",Se="_AssetThumbnail_evmri_11",Ae="_AssetResolved_evmri_26",Le="_AssetInput_evmri_35",Ie="_AssetButton_evmri_44",p={Asset:xe,AssetThumbnail:Se,AssetResolved:Ae,Error:"_Error_evmri_31",AssetInput:Le,AssetButton:Ie};var Ee=w("<img>"),De=w('<div title="Image not found">'),Z=w("<div>"),pe=w('<button title="Move Up">'),Ne=w('<button title="Move Down">'),Be=w('<button title="Remove Item">'),Fe=w('<div><input type=text placeholder="Type a name here..."><datalist></datalist><button title="Upload New Asset"></button><input type=file style=display:none>'),Ue=w("<option>");const J=e=>{const $=Y(),a=Y(),n=ye(),[u,g]=re(),[i,h]=B(!1),v=ge(u,()=>e.asset),t=()=>Object.keys(u()?.assets??{}).filter(l=>u()?.assets[l]?.type===e.type),[r,o]=B("");z(()=>{e.assetIdentity,u()!=null&&e.asset!=null?t().includes(e.asset)?o(e.asset):o(""):o(e.asset??"")});const y=async l=>{const d=l.currentTarget.value;o(d);const P=t().find(C=>C===d);P!=null&&e.onIdChange(P)},m=async l=>{if(u()===void 0)return;const d=r();if(d===""){alert("Cannot upload asset with empty name.");return}const P=l.currentTarget.files;if(P==null||P.length<1)return;const C=P[0],D=await n.storeAsset(C);g(s=>({...s,assets:{...s.assets,[d]:{alt:"",attrib:"",type:e.type,...d in s.assets?s.assets[d]:{},hash:D}}})),e.asset!==d&&e.onIdChange(d)},k=()=>{h(!0)},S=()=>{h(!1)},_=()=>{v()!=null&&window.open(v(),"_blank")};return(()=>{var l=Fe(),d=l.firstChild,P=d.nextSibling,C=P.nextSibling,D=C.nextSibling;return f(l,c(N,{get when(){return e.type==="image"},get children(){return[(()=>{var s=Ee();return s.$$click=_,s.addEventListener("error",S),s.addEventListener("load",k),b(I=>{var A=e.asset===r()?v():"",U=p.AssetThumbnail,R={[p.Error]:!i()};return A!==I.e&&T(s,"src",I.e=A),U!==I.t&&x(s,I.t=U),I.a=V(s,R,I.a),I},{e:void 0,t:void 0,a:void 0}),s})(),c(N,{get when(){return!i()||e.asset!==r()},get children(){var s=De();return s.$$click=()=>window.open(v(),"_blank"),f(s,c(ve,{})),b(()=>x(s,p.AssetThumbnail)),s}})]}}),d),f(l,c(N,{get when(){return e.type==="audio"},get children(){var s=Z();return s.$$click=_,f(s,c($e,{size:24})),b(()=>x(s,p.AssetThumbnail)),s}}),d),f(l,c(N,{get when(){return e.type==="tiles"},get children(){var s=Z();return s.$$click=_,f(s,c(fe,{size:24})),b(()=>x(s,p.AssetThumbnail)),s}}),d),d.$$input=y,T(d,"list",$),T(P,"id",$),f(P,c(ie,{get each(){return t()},children:s=>(()=>{var I=Ue();return I.value=s,I})()})),f(l,c(N,{get when(){return e.onUpClick},get children(){var s=pe();return G(s,"click",e.onUpClick,!0),f(s,c(ae,{})),b(()=>x(s,p.AssetButton)),s}}),C),f(l,c(N,{get when(){return e.onDownClick},get children(){var s=Ne();return G(s,"click",e.onDownClick,!0),f(s,c(oe,{})),b(()=>x(s,p.AssetButton)),s}}),C),C.$$click=()=>document.getElementById(a)?.click(),f(C,c(se,{})),f(l,c(N,{get when(){return e.onDeleteClick},get children(){var s=Be();return G(s,"click",e.onDeleteClick,!0),f(s,c(ue,{})),b(()=>x(s,p.AssetButton)),s}}),D),D.$$input=m,T(D,"id",a),b(s=>{var I=e.id,A=p.Asset,U={[p.AssetResolved]:e.asset===r()&&v()!=null},R=p.AssetInput,j=p.AssetButton;return I!==s.e&&T(l,"id",s.e=I),A!==s.t&&x(l,s.t=A),s.a=V(l,U,s.a),R!==s.o&&x(d,s.o=R),j!==s.i&&x(C,s.i=j),s},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),b(()=>d.value=r()),l})()};M(["click","input"]);const Re="_Gallery_1vx5l_1",qe={Gallery:Re};var Me=w("<div><button class=primary>Add Image");const ce=e=>{const $=()=>{e.onChange([...e.value,""])},a=i=>h=>{e.onChange([...e.value.slice(0,i),h,...e.value.slice(i+1)])},n=i=>()=>{e.onChange([...e.value.slice(0,i),...e.value.slice(i+1)])},u=i=>()=>{i<=0||i>=e.value.length||e.onChange([...e.value.slice(0,i-1),e.value[i],e.value[i-1],...e.value.slice(i+1)])},g=i=>()=>{i<0||i>=e.value.length-1||e.onChange([...e.value.slice(0,i),e.value[i+1],e.value[i],...e.value.slice(i+2)])};return(()=>{var i=Me(),h=i.firstChild;return f(i,c(_e,{get each(){return e.value},children:(v,t)=>c(J,{get assetIdentity(){return e.valueIdentity},get asset(){return v()},type:"image",get onIdChange(){return a(t)},get onDeleteClick(){return n(t)},get onUpClick(){return u(t)},get onDownClick(){return g(t)}})}),h),h.$$click=$,b(v=>{var t=qe.Gallery,r=e.id;return t!==v.e&&x(i,v.e=t),r!==v.t&&T(i,"id",v.t=r),v},{e:void 0,t:void 0}),i})()};M(["click"]);class H extends Error{}const de=async e=>{if(e.length===0)return[];if(e.length===1)return[e[0]];if(e.length>10){let u=[];for(let g=0;g*10<e.length;g++)u=[...u,...await de(e.slice(Math.max(g*10-1,0),Math.min(g*10+10,e.length)))];return u}const $={locations:e.map(u=>({lat:u.lat,lon:u.lng})),costing:"auto",units:"miles"};let a,n;try{a=await fetch("https://valhalla1.openstreetmap.de/route",{method:"POST",body:JSON.stringify($),headers:{"Content-Type":"application/json"}}),n=await a.json()}catch(u){throw new H("Unable to generate the path connecting the tour stops along roads. This is likely due to a service connectivity issue. Please try again later and report the issue if it persists.",{cause:u})}if(!a.ok)throw typeof n=="object"&&n!=null&&"error"in n&&typeof n.error=="string"?new H("Unable to generate the path connecting the tour stops along roads. The following error message was received from the external service used to perform this task: "+n.error):new H("Unable to generate the path connecting the tour stops along roads. This is likely due to a bug or a temporary service outage. Please try again later and report the issue if it persists.");if(typeof n=="object"&&n!=null&&"trip"in n&&typeof n.trip=="object"&&n.trip!=null&&"legs"in n.trip&&typeof n.trip.legs=="object"&&n.trip.legs!=null&&Array.isArray(n.trip.legs)){const u=[{lat:e[0].lat,lng:e[0].lng}];let g=1;for(const i of n.trip.legs){if(typeof i!="object"||i==null||!("shape"in i)||typeof i.shape!="string"){console.warn("Invalid trip leg, ignoring and continuing route calculation...",i);continue}const h=i;e[g].control==="route"?u.push(...Pe(h.shape).map(v=>({lat:v.lat/10,lng:v.lng/10}))):u.push({lat:e[g].lat,lng:e[g].lng}),g++}return u}else throw new H("Unable to generate the path connecting the tour stops along roads. An invalid response was received from the external service used to perform this task. Please try again later and report the issue if it persists.")};function je(){const[e,$]=W(),[a,n]=B([]);z(async()=>{if(e()==null)return;const u=e().route.filter(h=>h.control!=="none").map(h=>({lat:h.lat,lng:h.lng,control:h.control})),g=()=>u.length===a().length,i=()=>u.every((h,v)=>{const t=a()[v];return h.lat===t?.lat&&h.lng===t?.lng&&h.control===t?.control});if(!(g()&&i())){n(u);try{const h=await de(u);$(v=>({...v,path:ke(h)}))}catch(h){console.error("Error while routing:",h),h instanceof H?F.error(h.message):F.error("An internal error was encountered while generating the path connecting the tour stops along roads.")}}})}const He="_LatLngEditor_tsvoh_1",Ve={LatLngEditor:He};var Ge=w("<div>"),ee=w("<input type=text>");const he=e=>{const[a,n]=B(e.lat??0),[u,g]=B(e.lng??0),[i,h]=B(q(a().toString(),6)),[v,t]=B(q(u().toString(),6)),r=y=>{const m=y.currentTarget.value.trim();let k;if(m==="")n(k=0),h("0");else{const S=/-?0*(\d*(\.\d*)?)/.exec(m)?.[1];if(S==null)return;const _=q(m.startsWith("-")?"-"+S:S,6);n(k=Number.parseFloat(_)),h(_)}e.onChange(k,u())},o=y=>{const m=y.currentTarget.value.trim();let k;if(m==="")g(k=0),t("0");else{const S=/-?0*(\d*(\.\d*)?)/.exec(m)?.[1];if(S==null)return;const _=q(m.startsWith("-")?"-"+S:S,6);g(k=Number.parseFloat(_)),t(_)}e.onChange(a(),k)};return z(()=>{e.lat!==0&&a()!==e.lat&&(n(e.lat),h(q(a().toString(),6))),e.lng!==0&&u()!==e.lng&&(g(e.lng),t(q(u().toString(),6)))}),(()=>{var y=Ge();return f(y,c(L,{label:"Latitude",children:m=>(()=>{var k=ee();return k.$$input=r,T(k,"id",m),b(()=>k.value=i()),k})()}),null),f(y,c(L,{label:"Longitude",children:m=>(()=>{var k=ee();return k.$$input=o,T(k,"id",m),b(()=>k.value=v()),k})()}),null),b(m=>{var k=Ve.LatLngEditor,S=e.id;return k!==m.e&&x(y,m.e=k),S!==m.t&&T(y,"id",m.t=S),m},{e:void 0,t:void 0}),y})()};function q(e,$){const a=e.split(".");return a.length===0?"":a.length===1?e:`${a[0]}.${a[1].substring(0,$)}`}M(["input"]);const We="_ControlPointEditorPanel_17bzx_1",Oe={ControlPointEditorPanel:We};var ze=w("<div>"),Je=w("<div><input type=radio value=path><label>Path"),Qe=w("<div><input type=radio value=route><label>Route");const Ke=e=>{const $=(n,u)=>{n===e.controlPoint().lat&&u===e.controlPoint().lng||e.onChange({...e.controlPoint(),lat:n,lng:u})},a=n=>{if(!n.currentTarget.checked)return;const u=n.currentTarget.value;u==="path"||u==="route"?e.onChange({...e.controlPoint(),control:u}):console.error("Unexpected value:",u)};return c(N,{get when(){return e.controlPoint()},get children(){var n=ze();return f(n,c(L,{children:u=>c(he,{id:u,get lat(){return e.controlPoint().lat},get lng(){return e.controlPoint().lng},onChange:$})}),null),f(n,c(L,{set:!0,label:"Control Type",children:u=>[(()=>{var g=Je(),i=g.firstChild,h=i.nextSibling;return i.$$input=a,T(i,"id",`${u}-path`),T(h,"for",`${u}-path`),b(()=>i.checked=e.controlPoint().control==="path"),g})(),(()=>{var g=Qe(),i=g.firstChild,h=i.nextSibling;return i.$$input=a,T(i,"id",`${u}-route`),T(h,"for",`${u}-route`),b(()=>i.checked=e.controlPoint().control==="route"),g})()]}),null),b(()=>x(n,Oe.ControlPointEditorPanel)),n}})};M(["input"]);const Xe="_MainPanel_19aeq_3",Ye="_Hidden_19aeq_14",Ze="_PointsHeader_19aeq_18",et="_Pois_19aeq_43",tt="_PointsList_19aeq_51",nt="_PointCard_19aeq_58",lt="_PointName_19aeq_67",rt="_PointButton_19aeq_73",it="_AddButtons_19aeq_81",at="_SubPanel_19aeq_89",ot="_SubPanelBar_19aeq_100",st="_SubPanelClose_19aeq_110",E={MainPanel:Xe,Hidden:Ye,PointsHeader:Ze,Pois:et,PointsList:tt,PointCard:nt,PointName:lt,PointButton:rt,AddButtons:it,SubPanel:at,SubPanelBar:ot,SubPanelClose:st},ut="_StopEditorPanel_1yq6l_1",ct={StopEditorPanel:ut};var dt=w("<div>"),ht=w("<input type=text placeholder=Title>"),gt=w("<textarea placeholder=Description>"),te=w("<input type=text>"),vt=w("<textarea rows=8 placeholder=Transcript>"),$t=w("<div><input type=radio value=path><label>Path"),ft=w("<div><input type=radio value=route><label>Route"),yt=w("<div><input type=radio value=none><label>None");const _t=e=>{const $=t=>{e.onChange({...e.waypoint(),title:t.currentTarget.value})},a=t=>{e.onChange({...e.waypoint(),desc:t.currentTarget.value})},n=t=>{+t.currentTarget.value!=0&&!Number.isNaN(+t.currentTarget.value)&&e.onChange({...e.waypoint(),trigger_radius:+t.currentTarget.value})},u=(t,r)=>{t===e.waypoint().lat&&r===e.waypoint().lng||e.onChange({...e.waypoint(),lat:t,lng:r})},g=t=>{e.onChange({...e.waypoint(),transcript:t.currentTarget.value})},i=t=>{e.onChange({...e.waypoint(),narration:t.trim()===""?void 0:t.trim()})},h=t=>{t.currentTarget.value===""?e.onChange({...e.waypoint(),links:{}}):e.onChange({...e.waypoint(),links:{"Site Link":{href:t.currentTarget.value}}})},v=t=>{if(!t.currentTarget.checked)return;const r=t.currentTarget.value;r==="path"||r==="route"||r==="none"?e.onChange({...e.waypoint(),control:r}):console.error("Unexpected value:",r)};return c(N,{get when(){return e.waypoint()},get children(){var t=dt();return f(t,c(L,{label:"Title",children:r=>(()=>{var o=ht();return o.$$input=$,T(o,"id",r),b(()=>o.value=e.waypoint().title),o})()}),null),f(t,c(L,{label:"Description",children:r=>(()=>{var o=gt();return o.$$input=a,T(o,"id",r),b(()=>o.value=e.waypoint().desc),o})()}),null),f(t,c(L,{label:"Trigger Radius",children:r=>(()=>{var o=te();return o.$$input=n,T(o,"id",r),b(()=>o.value=e.waypoint().trigger_radius),o})()}),null),f(t,c(L,{children:r=>c(he,{id:r,get lat(){return e.waypoint().lat},get lng(){return e.waypoint().lng},onChange:u})}),null),f(t,c(L,{label:"Gallery",children:r=>c(ce,{id:r,get value(){return e.waypoint().gallery},onChange:o=>{e.onChange({...e.waypoint(),gallery:o})}})}),null),f(t,c(L,{label:"Narration",children:r=>c(J,{id:r,type:"audio",get asset(){return e.waypoint().narration??void 0},onIdChange:i})}),null),f(t,c(L,{label:"Transcript",children:r=>(()=>{var o=vt();return o.$$input=g,T(o,"id",r),b(()=>o.value=e.waypoint().transcript??""),o})()}),null),f(t,c(L,{label:"Site Link",children:r=>(()=>{var o=te();return o.$$input=h,T(o,"id",r),b(()=>o.value=e.waypoint().links["Site Link"]?.href??""),o})()}),null),f(t,c(L,{set:!0,label:"Control Type",children:r=>[(()=>{var o=$t(),y=o.firstChild,m=y.nextSibling;return y.$$input=v,T(y,"id",`${r}-path`),T(m,"for",`${r}-path`),b(()=>y.checked=e.waypoint().control==="path"),o})(),(()=>{var o=ft(),y=o.firstChild,m=y.nextSibling;return y.$$input=v,T(y,"id",`${r}-route`),T(m,"for",`${r}-route`),b(()=>y.checked=e.waypoint().control==="route"),o})(),(()=>{var o=yt(),y=o.firstChild,m=y.nextSibling;return y.$$input=v,T(y,"id",`${r}-none`),T(m,"for",`${r}-none`),b(()=>y.checked=e.waypoint().control==="none"),o})()]}),null),b(()=>x(t,ct.StopEditorPanel)),t}})};M(["input"]);var mt=w("<span class=field-label>Tiles"),Ct=w("<span class=hint style=margin-bottom:4px>Adding map tiles to your tour is optional. If you don't know what those are, ignore this field."),bt=w("<header><button>Route</button><button>POIs"),wt=w("<div style=flex:1>"),Pt=w("<button class=danger style=margin-top:32px>Delete Tour"),kt=w("<div>"),ne=w("<input type=text>"),Tt=w("<textarea>"),xt=w("<div><input type=radio name=control value=driving><label>Driving"),St=w("<div><input type=radio name=control value=walking><label>Walking"),At=w("<div><div><button class=primary>Add Stop</button><button class=primary>Add Control Point</button><input type=file accept=.csv><button class=secondary> Import CSV"),Lt=w("<div><div></div><button></button><button></button><button></button><button>"),It=w("<div><div><button></button><div>");const Ut=()=>{const[e,$]=W(),[a,n]=B({which:"main"});je();const u=()=>{const v=a(),t=e()?.route.find(r=>v.which==="stop"&&r.type==="stop"&&r.id===v.id);if(t!=null&&t.type==="stop")return t},g=v=>{const t=e()?.route.findIndex(r=>r.type==="stop"&&r.id===v.id);t===void 0||t<0||$({...e(),route:[...e().route.slice(0,t),v,...e().route.slice(t+1)]})},i=()=>{const v=a(),t=e()?.route.find(r=>v.which==="control"&&r.type==="control"&&r.id===v.id);if(t!=null&&t.type==="control")return t},h=v=>{const t=e()?.route.findIndex(r=>r.type==="control"&&r.id===v.id);t===void 0||t<0||$({...e(),route:[...e().route.slice(0,t),v,...e().route.slice(t+1)]})};return[c(Et,{get show(){return a().which==="main"},setPanel:n}),c(le,{get show(){return a().which==="stop"},title:"Edit Stop",onClose:()=>n({which:"main"}),get children(){return c(_t,{waypoint:u,onChange:g})}}),c(le,{get show(){return a().which==="control"},title:"Edit Control Point",onClose:()=>n({which:"main"}),get children(){return c(Ke,{controlPoint:i,onChange:h})}})]},Et=e=>{const[$]=re(),[a,n,u]=W(),g=me(),[i,h]=B("route"),v=_=>{n(l=>({...l,title:_.currentTarget.value}))},t=_=>{n(l=>({...l,desc:_.currentTarget.value}))},r=_=>{n(l=>({...l,tiles:_}))},o=_=>{if(!_.currentTarget.checked)return;const l=_.currentTarget.value;l==="driving"||l==="walking"?n({...a(),type:l}):console.error("Unexpected value:",l)},y=_=>{const l=a();n({...l,links:{"Site Link":{href:_.currentTarget.value}}})},m=_=>{const l=a();n({...l,gallery:_})},k=_=>{const l=a();n({...l,route:_})},S=async()=>{const _=$();_!=null&&confirm("Are you sure you want to delete the tour? This action canot be undone.")&&(u(),g(`/projects/${_.id}`))};return(()=>{var _=kt();return f(_,c(N,{get when(){return a()},get children(){return[c(L,{label:"Title",children:l=>(()=>{var d=ne();return d.$$input=v,T(d,"id",l),b(()=>d.value=a().title),d})()}),c(L,{label:"Description",children:l=>(()=>{var d=Tt();return d.$$input=t,T(d,"id",l),b(()=>d.value=a().desc),d})()}),mt(),Ct(),c(L,{children:l=>c(J,{id:l,type:"tiles",get asset(){return a().tiles},onIdChange:r})}),c(L,{set:!0,label:"Type",children:l=>[(()=>{var d=xt(),P=d.firstChild,C=P.nextSibling;return P.$$input=o,T(P,"id",`${l}-driving`),T(C,"for",`${l}-driving`),b(()=>P.checked=a().type==="driving"),d})(),(()=>{var d=St(),P=d.firstChild,C=P.nextSibling;return P.$$input=o,T(P,"id",`${l}-walking`),T(C,"for",`${l}-walking`),b(()=>P.checked=a().type==="walking"),d})()]}),c(L,{label:"Site Link",children:l=>(()=>{var d=ne();return d.$$input=y,T(d,"id",l),b(()=>d.value=a().links["Site Link"]?.href??""),d})()}),c(L,{label:"Gallery",children:l=>c(ce,{id:l,get valueIdentity(){return a()?.id},get value(){return a().gallery},onChange:m})}),(()=>{var l=bt(),d=l.firstChild,P=d.nextSibling;return d.$$click=()=>h("route"),P.$$click=()=>h("pois"),b(C=>V(l,{[E.PointsHeader]:!0,[E.Pois]:i()==="pois"},C)),l})(),c(N,{get when(){return i()==="route"},get children(){return c(Nt,{route:()=>a().route,onChange:k,onEditClick:(l,d)=>e.setPanel({which:d,id:l})})}}),c(N,{get when(){return i()==="pois"},children:"Points of interest are not currently implemented."}),wt(),(()=>{var l=Pt();return l.$$click=S,l})()]}})),b(l=>{var d=E.MainPanel,P={[E.Hidden]:!e.show};return d!==l.e&&x(_,l.e=d),l.t=V(_,P,l.t),l},{e:void 0,t:void 0}),_})()},Dt=e=>{const $=[],a=e.replace(/\r\n/g,`
`).replace(/\r/g,`
`);let n=0;const u=[];for(;n<a.length;){const i=[];for(;n<a.length;){let h="";if(a[n]==='"')for(n++;n<a.length;)if(a[n]==='"')if(a[n+1]==='"')h+='"',n+=2;else{n++;break}else h+=a[n],n++;else{for(;n<a.length&&a[n]!==","&&a[n]!==`
`;)h+=a[n],n++;h=h.trim()}if(i.push(h),n>=a.length||a[n]===`
`){n++;break}a[n]===","&&n++}i.length>0&&i.some(h=>h.length>0)&&u.push(i)}if(u.length<2)return[];const g=u[0];for(let i=1;i<u.length;i++){const h={};g.forEach((v,t)=>{h[v]=u[i][t]||""}),$.push(h)}return $},pt=(e,$)=>!isNaN(e)&&!isNaN($)&&isFinite(e)&&isFinite($)&&e>=-90&&e<=90&&$>=-180&&$<=180,Nt=e=>{const $=Te(),[a]=W();let n;const u=t=>{const r=t.target,o=r.files?.[0];if(!o)return;const y=new FileReader;y.onload=m=>{try{const k=m.target?.result,S=Dt(k);if(S.length===0){F.error("No valid data found in CSV");return}const _=S.filter(C=>{const D=parseFloat(C.Latitude),s=parseFloat(C.Longitude);return pt(D,s)}).sort((C,D)=>parseInt(C.Order||"0")-parseInt(D.Order||"0")),l=S.length-_.length,d=_.map(C=>({type:"stop",id:O(),title:C.Name||"Untitled",desc:C.Description||"",lat:parseFloat(C.Latitude),lng:parseFloat(C.Longitude),trigger_radius:30,control:a()?.type==="walking"?"path":"route",gallery:[],narration:void 0,transcript:void 0,links:{}}));if(d.length===0){F.error("No stops with valid coordinates found");return}l>0&&F(`Skipped ${l} rows with invalid coordinates`),e.onChange([...e.route(),...d]);const P=S.filter(C=>C["Audio File Name"]?.trim()).map(C=>C["Audio File Name"].trim());P.length>0?F.success(`Imported ${d.length} stops. Note: ${P.length} audio files referenced - upload them separately in each stop's settings.`):F.success(`Imported ${d.length} stops successfully!`)}catch(k){console.error("CSV import error:",k),F.error("Failed to parse CSV file")}r.value=""},y.readAsText(o)},g=()=>{const t={type:"stop",id:O(),title:"Untitled",desc:"",lat:$()?.getCenter().lat??0,lng:$()?.getCenter().lng??0,narration:void 0,trigger_radius:30,transcript:void 0,gallery:[],control:a()?.type==="walking"?"path":"route",links:{}};e.onChange([...e.route(),t])},i=()=>{const t={type:"control",id:O(),lat:$()?.getCenter().lat??0,lng:$()?.getCenter().lng??0,control:a()?.type==="walking"?"path":"route"};e.onChange([...e.route(),t])},h=(t,r)=>{const o=e.route().findIndex(y=>y.id===t);if(o!==-1){if(r==="up"){if(o===0)return;e.onChange([...e.route().slice(0,o-1),e.route()[o],e.route()[o-1],...e.route().slice(o+1)])}else if(r==="down"){if(o===e.route().length-1)return;e.onChange([...e.route().slice(0,o),e.route()[o+1],e.route()[o],...e.route().slice(o+2)])}}},v=t=>{const r=e.route().findIndex(m=>m.id===t),o=e.route()[r],y=o.type==="control"?"Control Point":o.title;confirm(`Are you sure you want to delete the waypoint "${y}"? This action cannot be undone.`)&&e.onChange([...e.route().slice(0,r),...e.route().slice(r+1)])};return(()=>{var t=At(),r=t.firstChild,o=r.firstChild,y=o.nextSibling,m=y.nextSibling,k=m.nextSibling,S=k.firstChild;f(t,c(ie,{get each(){return e.route()},children:l=>(()=>{var d=Lt(),P=d.firstChild,C=P.nextSibling,D=C.nextSibling,s=D.nextSibling,I=s.nextSibling;return f(P,()=>l.type==="stop"?l.title:"Control Point"),C.$$click=()=>{h(l.id,"up")},f(C,c(ae,{})),D.$$click=()=>{h(l.id,"down")},f(D,c(oe,{})),s.$$click=()=>{e.onEditClick(l.id,l.type)},f(s,c(Ce,{})),I.$$click=()=>{v(l.id)},f(I,c(ue,{})),b(A=>{var U=E.PointCard,R=E.PointName,j=E.PointButton,Q=E.PointButton,K=E.PointButton,X=E.PointButton;return U!==A.e&&x(d,A.e=U),R!==A.t&&x(P,A.t=R),j!==A.a&&x(C,A.a=j),Q!==A.o&&x(D,A.o=Q),K!==A.i&&x(s,A.i=K),X!==A.n&&x(I,A.n=X),A},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),d})()}),r),o.$$click=g,y.$$click=i,m.addEventListener("change",u);var _=n;return typeof _=="function"?we(_,m):n=m,m.style.setProperty("display","none"),k.$$click=()=>n?.click(),f(k,c(se,{style:{"margin-right":"4px"}}),S),b(l=>{var d=E.PointsList,P=E.AddButtons;return d!==l.e&&x(t,l.e=d),P!==l.t&&x(r,l.t=P),l},{e:void 0,t:void 0}),t})()},le=e=>(()=>{var $=It(),a=$.firstChild,n=a.firstChild,u=n.nextSibling;return G(n,"click",e.onClose,!0),f(n,c(be,{})),f(u,()=>e.title),f($,()=>e.children,null),b(g=>{var i=E.SubPanel,h={[E.Hidden]:!e.show},v=E.SubPanelBar,t=E.SubPanelClose,r=E.SubPanelTitle;return i!==g.e&&x($,g.e=i),g.t=V($,h,g.t),v!==g.a&&x(a,g.a=v),t!==g.o&&x(n,g.o=t),r!==g.i&&x(u,g.i=r),g},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),$})();M(["click","input"]);export{Ut as TourEditorPanel,Ut as default};
